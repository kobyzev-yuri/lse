# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π (Vector Knowledge Base)

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ß—Ç–æ –µ—Å—Ç—å
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `trade_kb` –≤ PostgreSQL —Å –ø–æ–ª–µ–º `embedding vector(1536)`
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `pgvector` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö embeddings

### –ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚ùå –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π/—Å–æ–±—ã—Ç–∏–π
- ‚ùå –í—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ `trade_kb`
- ‚ùå –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π
- ‚ùå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `AnalystAgent` –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∏–π

---

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

–í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–ó (`trade_kb`) –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è:

1. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤**
   - –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–∏—Ç—É–∞—Ü–∏–π –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ
   - –ê–Ω–∞–ª–∏–∑, –∫–∞–∫ —Ä—ã–Ω–æ–∫ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª –Ω–∞ –ø–æ—Ö–æ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏/—Å–æ–±—ã—Ç–∏—è
   - –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç

2. **RAG (Retrieval-Augmented Generation)**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞
   - –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ + sentiment + –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

3. **–û–±–æ–≥–∞—â–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ `knowledge_base` –≤ `trade_kb` —Å embeddings
   - –ü–æ–∏—Å–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ —Å–º—ã—Å–ª—É, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ —Ç–∏–∫–µ—Ä—É

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

```mermaid
flowchart TD
    A[–ù–æ–≤–æ—Å—Ç—å/–°–æ–±—ã—Ç–∏–µ] --> B[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è embedding —á–µ—Ä–µ–∑ OpenAI]
    B --> C[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ trade_kb]
    C --> D[–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π]
    D --> E[–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ AnalystAgent]
    
    F[knowledge_base] --> G[–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è]
    G --> B
    
    H[–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–¥–µ–ª–∫–∏] --> I[–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤]
    I --> B
```

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π —Ç–∞–±–ª–∏—Ü

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|---------|-----------|---------------|
| `knowledge_base` | –ù–æ–≤–æ—Å—Ç–∏ —Å sentiment –∞–Ω–∞–ª–∏–∑–æ–º | –í—Ä–µ–º–µ–Ω–Ω–æ–π –ø–æ–∏—Å–∫ –ø–æ —Ç–∏–∫–µ—Ä—É, —Ä–∞—Å—á–µ—Ç sentiment |
| `trade_kb` | –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ embeddings | –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π –ø–æ —Å–º—ã—Å–ª—É, RAG |

---

## –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–æ–±–∞–≤–∏—Ç—å –≤ `requirements.txt`:

```txt
openai>=1.0.0  # –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ embeddings
# –∏–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:
# sentence-transformers>=2.2.0  # –î–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö embeddings (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
```

### 2. API –∫–ª—é—á OpenAI

–î–æ–±–∞–≤–∏—Ç—å –≤ `../brats/config.env`:

```env
OPENAI_API_KEY=sk-...
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sentence-transformers` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ embeddings (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤).

### 3. –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `vector_kb.py`

–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

```python
class VectorKB:
    def __init__(self):
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OpenAI –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ sentence-transformers
    
    def generate_embedding(self, text: str) -> list[float]:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç embedding –¥–ª—è —Ç–µ–∫—Å—Ç–∞"""
    
    def add_event(self, ticker: str, event_type: str, content: str, ts: datetime):
        """–î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ trade_kb —Å embedding"""
    
    def search_similar(self, query: str, ticker: str = None, limit: int = 5) -> pd.DataFrame:
        """–ò—â–µ—Ç –ø–æ—Ö–æ–∂–∏–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫"""
    
    def sync_from_knowledge_base(self):
        """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ knowledge_base –≤ trade_kb"""
```

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AnalystAgent

–î–æ–±–∞–≤–∏—Ç—å –≤ `analyst_agent.py`:

```python
def get_historical_context(self, ticker: str, current_situation: str) -> str:
    """–ò—â–µ—Ç –ø–æ—Ö–æ–∂–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–ó"""
    vector_kb = VectorKB()
    similar_events = vector_kb.search_similar(
        query=current_situation,
        ticker=ticker,
        limit=5
    )
    # –§–æ—Ä–º–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∏—è
```

---

## –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

### –®–∞–≥ 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–ó

```mermaid
sequenceDiagram
    participant News as –ù–æ–≤–æ—Å—Ç—å (knowledge_base)
    participant VectorKB as VectorKB
    participant OpenAI as OpenAI API
    participant DB as PostgreSQL (trade_kb)
    
    News->>VectorKB: –ù–æ–≤–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞
    VectorKB->>OpenAI: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embedding
    OpenAI-->>VectorKB: embedding[1536]
    VectorKB->>DB: INSERT –≤ trade_kb
```

### –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∞–Ω–∞–ª–∏–∑–µ

```mermaid
flowchart TD
    A[AnalystAgent.get_decision] --> B[–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑]
    A --> C[Sentiment –∞–Ω–∞–ª–∏–∑]
    A --> D[–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π]
    
    D --> E[–ü–æ–∏—Å–∫ –≤ trade_kb —á–µ—Ä–µ–∑ pgvector]
    E --> F[–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ø-5 –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π]
    F --> G[–ê–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–æ–≤ —ç—Ç–∏—Ö —Å–æ–±—ã—Ç–∏–π]
    G --> H[–£–ª—É—á—à–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è]
    
    B --> I[–§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ]
    C --> I
    H --> I
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π

```python
from vector_kb import VectorKB

vector_kb = VectorKB()

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ knowledge_base
vector_kb.sync_from_knowledge_base()
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π

```python
# –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è: "MSFT –æ–±—ä—è–≤–∏–ª –æ –Ω–æ–≤–æ–º –ø—Ä–æ–¥—É–∫—Ç–µ, —Ü–µ–Ω–∞ –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ 3%"
similar = vector_kb.search_similar(
    query="MSFT –æ–±—ä—è–≤–∏–ª –æ –Ω–æ–≤–æ–º –ø—Ä–æ–¥—É–∫—Ç–µ, —Ü–µ–Ω–∞ –≤—ã—Ä–æ—Å–ª–∞",
    ticker="MSFT",
    limit=5
)

# –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ—Ö–æ–∂–∏–µ —Å–æ–±—ã—Ç–∏—è –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ —Å –∏—Ö –∏—Å—Ö–æ–¥–∞–º–∏
# –ú–æ–∂–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ —Ä—ã–Ω–æ–∫ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª –Ω–∞ –ø–æ—Ö–æ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏
```

### –ü—Ä–∏–º–µ—Ä 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AnalystAgent

```python
# –í analyst_agent.py
def get_decision(self, ticker: str) -> str:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    # –ù–æ–≤–æ–µ: –ø–æ–∏—Å–∫ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    current_situation = f"{ticker}: close={close}, sentiment={weighted_sentiment}"
    historical_context = self.get_historical_context(ticker, current_situation)
    
    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∏—è
    if historical_context:
        # –ê–Ω–∞–ª–∏–∑ –ø–æ—Ö–æ–∂–∏—Ö —Å–∏—Ç—É–∞—Ü–∏–π –∏ –∏—Ö –∏—Å—Ö–æ–¥–æ–≤
        pass
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings

**–í–∞—Ä–∏–∞–Ω—Ç 1: OpenAI API** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞)
- –ú–æ–¥–µ–ª—å: `text-embedding-3-small` (1536 –∏–∑–º–µ—Ä–µ–Ω–∏–π) –∏–ª–∏ `text-embedding-ada-002` (1536)
- –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$0.02 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤
- –¢—Ä–µ–±—É–µ—Ç API –∫–ª—é—á

**–í–∞—Ä–∏–∞–Ω—Ç 2: Sentence Transformers** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- –ú–æ–¥–µ–ª—å: `all-MiniLM-L6-v2` (384 –∏–∑–º–µ—Ä–µ–Ω–∏—è) –∏–ª–∏ `all-mpnet-base-v2` (768)
- –†–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç API
- –¢—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏ –∏ CPU

### –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤ PostgreSQL

```sql
-- –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π
SELECT 
    id, ticker, event_type, content, ts,
    1 - (embedding <=> :query_embedding) as similarity
FROM trade_kb
WHERE ticker = :ticker OR ticker IN ('MACRO', 'US_MACRO')
ORDER BY embedding <=> :query_embedding
LIMIT 5;
```

–û–ø–µ—Ä–∞—Ç–æ—Ä `<=>` - —ç—Ç–æ cosine distance –≤ pgvector.

### –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```sql
-- –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX IF NOT EXISTS trade_kb_embedding_idx 
ON trade_kb 
USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 100);
```

---

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (1-2 –¥–Ω—è)
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `vector_kb.py`
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é embeddings —á–µ—Ä–µ–∑ OpenAI
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ `trade_kb`
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫

### –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (1 –¥–µ–Ω—å)
1. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–∑ `knowledge_base` –≤ `trade_kb`
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `get_historical_context()` –≤ `AnalystAgent`
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π

### –≠—Ç–∞–ø 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (1 –¥–µ–Ω—å)
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
3. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

---

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- ‚úÖ –í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ `knowledge_base` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ `trade_kb`
- ‚úÖ –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (< 1 —Å–µ–∫—É–Ω–¥—ã)
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —É–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Ä–µ—à–µ–Ω–∏–π (Win Rate +2-5%)
- ‚úÖ –°—Ç–æ–∏–º–æ—Å—Ç—å OpenAI API < $10/–º–µ—Å—è—Ü –ø—Ä–∏ —Ç–µ–∫—É—â–µ–º –æ–±—ä–µ–º–µ –¥–∞–Ω–Ω—ã—Ö

---

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –í—ã—Å–æ–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å OpenAI API
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: 
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sentence-transformers` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å embeddings –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –¥–µ—à–µ–≤—É—é –º–æ–¥–µ–ª—å `text-embedding-3-small`

### –†–∏—Å–∫ 2: –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ embeddings
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ (threshold, limit)
- –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–µ –∏—Å–∫–∞—Ç—å —Å–æ–±—ã—Ç–∏—è —Å—Ç–∞—Ä—à–µ 1 –≥–æ–¥–∞)

### –†–∏—Å–∫ 3: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã `ivfflat` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (limit=5-10)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–∫–µ—Ä—É –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–°–æ–∑–¥–∞—Ç—å `vector_kb.py`** —Å –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é
2. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞
3. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å `AnalystAgent`** –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∏–π
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ API

---

**–°—Ç–∞—Ç—É—Å**: üü° –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –°—Ä–µ–¥–Ω–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–æ–≤)  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: OpenAI API –∫–ª—é—á –∏–ª–∏ sentence-transformers

