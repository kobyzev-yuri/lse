# –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —É—á–µ—Ç–∞ –≤–ª–∏—è–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π

**–î–∞—Ç–∞:** 2026-02-19  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìä –ê–Ω–∞–ª–∏–∑ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ —Ç–µ–∫—É—â–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –Ω–æ–≤–æ—Å—Ç–µ–π

### –¢–µ–∫—É—â–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

| –ò—Å—Ç–æ—á–Ω–∏–∫ | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | Sentiment | –ü–æ–∫—Ä—ã—Ç–∏–µ | –°—Ç–∞—Ç—É—Å |
|----------|-----------|----------|----------|--------|
| **RSS** (Fed, ECB, BOJ, BOE, FOMC) | –ú–∞–∫—Ä–æ-–Ω–æ–≤–æ—Å—Ç–∏, –∑–∞—è–≤–ª–µ–Ω–∏—è –¶–ë | ‚ùå –ù–µ—Ç | ‚úÖ –í—ã—Å–æ–∫–æ–µ (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏) | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **NewsAPI** | –ù–æ–≤–æ—Å—Ç–∏ –ø–æ —Ç–∏–∫–µ—Ä–∞–º/—Ä–µ–≥–∏–æ–Ω–∞–º | ‚ùå –ù–µ—Ç | ‚úÖ –°—Ä–µ–¥–Ω–µ–µ (–∞–≥—Ä–µ–≥–∞—Ç–æ—Ä Reuters/Bloomberg) | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **Alpha Vantage NEWS_SENTIMENT** | –ù–æ–≤–æ—Å—Ç–∏ + sentiment –ø–æ —Ç–∏–∫–µ—Ä–∞–º | ‚úÖ –î–∞ | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ–µ (–ª–∏–º–∏—Ç 25 req/day) | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **Alpha Vantage Earnings** | –ö–∞–ª–µ–Ω–¥–∞—Ä—å –æ—Ç—á–µ—Ç–æ–≤ | ‚Äî | ‚úÖ –•–æ—Ä–æ—à–µ–µ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **Alpha Vantage Economic Indicators** | CPI, GDP, Fed Rate, Treasury, Unemployment | ‚Äî | ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ (–ª–∏–º–∏—Ç) | ‚ö†Ô∏è –ß–∞—Å—Ç–æ –ª–∏–º–∏—Ç |
| **Investing.com Calendar** | –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å | ‚Äî | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–∞—Ä—Å–µ—Ä —Å–ª–æ–º–∞–Ω) | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç |

### –û—Ü–µ–Ω–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏

#### ‚úÖ –ß—Ç–æ –ø–æ–∫—Ä—ã—Ç–æ —Ö–æ—Ä–æ—à–æ

1. **–ú–∞–∫—Ä–æ-–Ω–æ–≤–æ—Å—Ç–∏ (–¶–ë):**
   - RSS —Ñ–∏–¥—ã —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã—Ö –±–∞–Ω–∫–æ–≤ –¥–∞—é—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∑–∞—è–≤–ª–µ–Ω–∏—è –∏ —Ä–µ—à–µ–Ω–∏—è
   - –ü–æ–∫—Ä—ã—Ç–∏–µ: USA (Fed), UK (BoE), EU (ECB), Japan (BoJ)
   - **–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ** –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ –º–∞–∫—Ä–æ-–∞–Ω–∞–ª–∏–∑–∞

2. **–ù–æ–≤–æ—Å—Ç–∏ –ø–æ —Ç–∏–∫–µ—Ä–∞–º:**
   - NewsAPI –¥–∞—ë—Ç –Ω–æ–≤–æ—Å—Ç–∏ –ø–æ —Ç–∏–∫–µ—Ä–∞–º –∏–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   - Alpha Vantage NEWS_SENTIMENT –¥–æ–±–∞–≤–ª—è–µ—Ç sentiment (–Ω–æ –ª–∏–º–∏—Ç 25 req/day)
   - **–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ** –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–∫–µ—Ä–æ–≤, –Ω–æ –ª–∏–º–∏—Ç—ã –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç —á–∞—Å—Ç–æ—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

3. **Earnings Calendar:**
   - Alpha Vantage –¥–∞—ë—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—å –æ—Ç—á–µ—Ç–æ–≤
   - **–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ** –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –≤–æ–∫—Ä—É–≥ earnings

#### ‚ö†Ô∏è –ß—Ç–æ –ø–æ–∫—Ä—ã—Ç–æ —á–∞—Å—Ç–∏—á–Ω–æ

1. **Sentiment –∞–Ω–∞–ª–∏–∑:**
   - –¢–æ–ª—å–∫–æ Alpha Vantage –¥–∞—ë—Ç –≥–æ—Ç–æ–≤—ã–π sentiment (–ª–∏–º–∏—Ç)
   - RSS –∏ NewsAPI –±–µ–∑ sentiment ‚Üí –Ω—É–∂–Ω–∞ –ø–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞ LLM
   - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫—É sentiment –¥–ª—è RSS/NewsAPI —á–µ—Ä–µ–∑ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π LLM (Groq/Ollama)

2. **–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
   - Alpha Vantage –¥–∞—ë—Ç CPI, GDP, Fed Rate –∏ —Ç.–¥., –Ω–æ —á–∞—Å—Ç–æ –ª–∏–º–∏—Ç
   - Investing.com –ø–∞—Ä—Å–µ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (–ª–∏–º–∏—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–ª–∞–Ω–∞) –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### ‚ùå –ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

1. **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π:**
   - –ù–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π
   - –ù–µ—Ç –ø–æ–∏—Å–∫–∞ "–ø–æ—Ö–æ–∂–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ"
   - –ù–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ "–∫–∞–∫ —Ä—ã–Ω–æ–∫ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª –Ω–∞ –ø–æ—Ö–æ–∂–∏–µ —Å–æ–±—ã—Ç–∏—è"

2. **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–æ–≤:**
   - –ù–µ—Ç —Å–≤—è–∑–∏ –Ω–æ–≤–æ—Å—Ç–µ–π —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º–∏ –¥–≤–∏–∂–µ–Ω–∏—è–º–∏ —Ü–µ–Ω—ã
   - –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ "—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏" –Ω–æ–≤–æ—Å—Ç–µ–π (–∫–∞–∫ —á–∞—Å—Ç–æ sentiment —Å–æ–≤–ø–∞–¥–∞–ª —Å –¥–≤–∏–∂–µ–Ω–∏–µ–º)

3. **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:**
   - –ù–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ "–≤ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è —Å—É—Ç–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏ –≤–ª–∏—è—é—Ç —Å–∏–ª—å–Ω–µ–µ"
   - –ù–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ "–∫–∞–∫ –¥–æ–ª–≥–æ –Ω–æ–≤–æ—Å—Ç—å –≤–ª–∏—è–µ—Ç –Ω–∞ —Ü–µ–Ω—É"

### –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

**–¢–µ–∫—É—â–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞**, –Ω–æ **–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ —É—á–µ—Ç–∞ –≤–ª–∏—è–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π**:

- ‚úÖ **–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ:** –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π, –±–∞–∑–æ–≤—ã–π sentiment, –≤—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- ‚ùå **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ:** –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π, –∞–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∏—Å—Ö–æ–¥–æ–≤, –ø—Ä–æ–≥–Ω–æ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

---

## üéØ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —É—á–µ—Ç–∞ –≤–ª–∏—è–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π

### –¶–µ–ª—å

–£–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π —á–µ—Ä–µ–∑:
1. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** –ø–æ—Ö–æ–∂–∏—Ö –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
2. **–ê–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–æ–≤** ‚Äî –∫–∞–∫ —Ä—ã–Ω–æ–∫ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª –Ω–∞ –ø–æ—Ö–æ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –≤ –ø—Ä–æ—à–ª–æ–º
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** –≤ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è

---

## –≠—Ç–∞–ø 1: –í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (Vector KB) ‚Äî –æ—Å–Ω–æ–≤–∞

### 1.1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π

**–ó–∞–¥–∞—á–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å embeddings –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ `knowledge_base` –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ `trade_kb`.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
# services/vector_kb.py

class VectorKB:
    def __init__(self):
        # –í–∞—Ä–∏–∞–Ω—Ç 1: OpenAI embeddings (–ø–ª–∞—Ç–Ω–æ, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ)
        # –í–∞—Ä–∏–∞–Ω—Ç 2: sentence-transformers –ª–æ–∫–∞–ª—å–Ω–æ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
        # –í–∞—Ä–∏–∞–Ω—Ç 3: Groq/Ollama –¥–ª—è embeddings (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç)
        
    def generate_embedding(self, text: str) -> list[float]:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç embedding –¥–ª—è —Ç–µ–∫—Å—Ç–∞"""
        # OpenAI: text-embedding-3-small (1536 dim)
        # –∏–ª–∏ sentence-transformers: all-MiniLM-L6-v2 (384 dim)
        
    def sync_from_knowledge_base(self, limit: int = None):
        """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ knowledge_base –≤ trade_kb"""
        # –î–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ—Å—Ç–∏ —Å NULL embedding:
        # 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º embedding
        # 2. –í—Å—Ç–∞–≤–ª—è–µ–º –≤ trade_kb
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- OpenAI API –∫–ª—é—á (–¥–ª—è `text-embedding-3-small`) –∏–ª–∏
- `sentence-transformers` (–ª–æ–∫–∞–ª—å–Ω–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ)

**–°—Ç–æ–∏–º–æ—Å—Ç—å (OpenAI):**
- ~$0.02 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤
- –î–ª—è 10,000 –Ω–æ–≤–æ—Å—Ç–µ–π (~100 —Ç–æ–∫–µ–Ω–æ–≤ –∫–∞–∂–¥–∞—è) ‚âà $0.20
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–∞—Ç—å —Å OpenAI, –ø—Ä–∏ —Ä–æ—Å—Ç–µ –æ–±—ä—ë–º–∞ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ embeddings

**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è

---

### 1.2. –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π

**–ó–∞–¥–∞—á–∞:** –ù–∞—Ö–æ–¥–∏—Ç—å —Ç–æ–ø-K –ø–æ—Ö–æ–∂–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π/—Å–æ–±—ã—Ç–∏–π –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –ø–æ —Å–º—ã—Å–ª—É (–Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º).

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
def search_similar(
    self, 
    query: str, 
    ticker: str = None, 
    limit: int = 5,
    min_similarity: float = 0.7,
    time_window_days: int = 365
) -> pd.DataFrame:
    """
    –ò—â–µ—Ç –ø–æ—Ö–æ–∂–∏–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤ trade_kb
    
    Returns:
        DataFrame —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏: id, ticker, content, ts, similarity, event_type
    """
    # 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º embedding –¥–ª—è query
    query_embedding = self.generate_embedding(query)
    
    # 2. –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ pgvector
    # SELECT ... FROM trade_kb
    # WHERE embedding <=> :query_embedding < threshold
    # ORDER BY similarity LIMIT :limit
```

**SQL –∑–∞–ø—Ä–æ—Å:**

```sql
SELECT 
    id, ticker, event_type, content, ts,
    1 - (embedding <=> :query_embedding) as similarity
FROM trade_kb
WHERE (ticker = :ticker OR ticker IN ('MACRO', 'US_MACRO'))
  AND ts >= NOW() - INTERVAL ':time_window_days days'
ORDER BY embedding <=> :query_embedding
LIMIT :limit;
```

**–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**

```sql
CREATE INDEX IF NOT EXISTS trade_kb_embedding_idx 
ON trade_kb 
USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 100);
```

**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å

---

## –≠—Ç–∞–ø 2: –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∏—Å—Ö–æ–¥–æ–≤

### 2.1. –°–≤—è–∑—å –Ω–æ–≤–æ—Å—Ç–µ–π —Å –¥–≤–∏–∂–µ–Ω–∏—è–º–∏ —Ü–µ–Ω—ã

**–ó–∞–¥–∞—á–∞:** –î–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ—Å—Ç–∏/—Å–æ–±—ã—Ç–∏—è –≤ `trade_kb` –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ —Ä—ã–Ω–æ–∫ –æ—Ç—Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ N –¥–Ω–µ–π.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
# services/news_impact_analyzer.py

class NewsImpactAnalyzer:
    def analyze_event_outcome(
        self, 
        event_id: int, 
        ticker: str,
        days_after: int = 7
    ) -> Dict[str, Any]:
        """
        –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥ —Å–æ–±—ã—Ç–∏—è: –∫–∞–∫ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å —Ü–µ–Ω–∞ –ø–æ—Å–ª–µ –Ω–æ–≤–æ—Å—Ç–∏
        
        Returns:
            {
                'price_change_pct': float,  # –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã —á–µ—Ä–µ–∑ N –¥–Ω–µ–π
                'max_gain_pct': float,      # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç
                'max_loss_pct': float,      # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ
                'volatility_change': float, # –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
                'sentiment_match': bool,    # –°–æ–≤–ø–∞–ª –ª–∏ sentiment —Å –¥–≤–∏–∂–µ–Ω–∏–µ–º
                'outcome': 'POSITIVE' | 'NEGATIVE' | 'NEUTRAL'
            }
        """
        # 1. –ü–æ–ª—É—á–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∏–∑ trade_kb
        # 2. –ü–æ–ª—É—á–∞–µ–º –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ –∑–∞ N –¥–Ω–µ–π –ø–æ—Å–ª–µ —Å–æ–±—ã—Ç–∏—è
        # 3. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏
        # 4. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ trade_kb (–Ω–æ–≤–æ–µ –ø–æ–ª–µ outcome_json)
```

**–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `trade_kb`:**

```sql
ALTER TABLE trade_kb 
ADD COLUMN IF NOT EXISTS outcome_json JSONB;

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –∏—Å—Ö–æ–¥—É
CREATE INDEX IF NOT EXISTS trade_kb_outcome_idx 
ON trade_kb USING GIN (outcome_json);
```

**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è

---

### 2.2. –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

**–ó–∞–¥–∞—á–∞:** –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ö–æ–∂–∏–µ —Å–æ–±—ã—Ç–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –æ–±—â–∏–µ –∏—Å—Ö–æ–¥—ã.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
def aggregate_patterns(
    self,
    similar_events: pd.DataFrame
) -> Dict[str, Any]:
    """
    –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥—ã –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π
    
    Returns:
        {
            'avg_price_change': float,
            'success_rate': float,  # % —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ sentiment —Å–æ–≤–ø–∞–ª —Å –¥–≤–∏–∂–µ–Ω–∏–µ–º
            'avg_volatility_change': float,
            'typical_outcome': str,
            'confidence': float  # –ù–∞—Å–∫–æ–ª—å–∫–æ —É–≤–µ—Ä–µ–Ω—ã –≤ –ø–∞—Ç—Ç–µ—Ä–Ω–µ
        }
    """
    # –ê–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–æ–≤ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π
    # –†–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```

**–í—Ä–µ–º—è:** 1-2 –¥–Ω—è

---

## –≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è

### 3.1. –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ AnalystAgent

**–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `get_historical_context()` –≤ `AnalystAgent`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–æ–≤.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
# analyst_agent.py

def get_historical_context(
    self, 
    ticker: str, 
    current_situation: str
) -> Dict[str, Any]:
    """
    –ò—â–µ—Ç –ø–æ—Ö–æ–∂–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Ö –∏—Å—Ö–æ–¥—ã
    
    Args:
        ticker: –¢–∏–∫–µ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        current_situation: –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏ (—Ç–µ–∫—Å—Ç)
        
    Returns:
        {
            'similar_events': List[Dict],  # –¢–æ–ø-5 –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π
            'pattern_analysis': Dict,      # –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
            'recommendation': str,         # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏
            'confidence': float
        }
    """
    from services.vector_kb import VectorKB
    from services.news_impact_analyzer import NewsImpactAnalyzer
    
    vector_kb = VectorKB()
    impact_analyzer = NewsImpactAnalyzer()
    
    # 1. –§–æ—Ä–º–∏—Ä—É–µ–º query –∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏
    query = f"{ticker}: {current_situation}"
    
    # 2. –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π
    similar_events = vector_kb.search_similar(
        query=query,
        ticker=ticker,
        limit=5
    )
    
    if similar_events.empty:
        return None
    
    # 3. –ê–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–æ–≤ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π
    pattern_analysis = impact_analyzer.aggregate_patterns(similar_events)
    
    # 4. –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é
    if pattern_analysis['success_rate'] > 0.7:
        recommendation = "HIGH_CONFIDENCE"
    elif pattern_analysis['success_rate'] > 0.5:
        recommendation = "MODERATE_CONFIDENCE"
    else:
        recommendation = "LOW_CONFIDENCE"
    
    return {
        'similar_events': similar_events.to_dict('records'),
        'pattern_analysis': pattern_analysis,
        'recommendation': recommendation,
        'confidence': pattern_analysis.get('confidence', 0.5)
    }
```

**–í—Ä–µ–º—è:** 2 –¥–Ω—è

---

### 3.2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ —Ä–µ—à–µ–Ω–∏—è—Ö

**–ó–∞–¥–∞—á–∞:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ `get_decision()` –∏ `get_decision_with_llm()`.

**–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `get_decision_with_llm()`:**

```python
def get_decision_with_llm(self, ticker: str) -> dict:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    # –ù–û–í–û–ï: –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    current_situation = (
        f"{ticker}: close={close:.2f}, "
        f"sentiment={weighted_sentiment:.3f}, "
        f"volatility={volatility_5:.4f}"
    )
    
    historical_context = self.get_historical_context(ticker, current_situation)
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∏—è
    if historical_context:
        pattern_analysis = historical_context['pattern_analysis']
        
        # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏
        if pattern_analysis['success_rate'] > 0.7:
            # –ï—Å–ª–∏ –ø–æ—Ö–æ–∂–∏–µ —Å–æ–±—ã—Ç–∏—è —á–∞—Å—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–∏ –∫ —É—Å–ø–µ—Ö—É
            confidence_multiplier = 1.2
        elif pattern_analysis['success_rate'] < 0.3:
            # –ï—Å–ª–∏ –ø–æ—Ö–æ–∂–∏–µ —Å–æ–±—ã—Ç–∏—è —á–∞—Å—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–∏ –∫ –Ω–µ—É–¥–∞—á–µ
            confidence_multiplier = 0.8
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ LLM –ø—Ä–æ–º–ø—Ç
        llm_context = f"""
–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:
- –ù–∞–π–¥–µ–Ω–æ {len(historical_context['similar_events'])} –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π
- –°—Ä–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –ø–æ—Å–ª–µ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π: {pattern_analysis['avg_price_change']:.2f}%
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω–∞: {pattern_analysis['success_rate']:.1%}
"""
    else:
        llm_context = ""
        confidence_multiplier = 1.0
    
    # –ü–µ—Ä–µ–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ LLM
    llm_result = self.llm_service.analyze_trading_situation(
        ticker=ticker,
        technical_data=technical_data,
        news_data=news_list,
        sentiment_score=sentiment_for_llm,
        historical_context=llm_context  # –ù–û–í–û–ï
    )
    
    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å LLM –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏
    if llm_result and historical_context:
        llm_result['llm_analysis']['confidence'] *= confidence_multiplier
    
    return {
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
        'historical_context': historical_context,  # –ù–û–í–û–ï
    }
```

**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è

---

### 3.3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ö

**–ó–∞–¥–∞—á–∞:** –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤.

**–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `StrategyManager.select_strategy()`:**

```python
def select_strategy(
    self,
    ticker: str,
    technical_data: Dict[str, Any],
    news_data: List[Dict[str, Any]],
    sentiment_score: float,
    historical_context: Dict[str, Any] = None  # –ù–û–í–û–ï
) -> Optional[BaseStrategy]:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    # –ù–û–í–û–ï: –£—á–∏—Ç—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    if historical_context:
        pattern_analysis = historical_context['pattern_analysis']
        
        # –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω–∞
        if pattern_analysis['success_rate'] > 0.7:
            # –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—É
            # –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å–ø–µ—Ö Momentum ‚Üí –≤—ã–±–∏—Ä–∞–µ–º Momentum
            pass
```

**–í—Ä–µ–º—è:** 1-2 –¥–Ω—è

---

## –≠—Ç–∞–ø 4: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### 4.1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

**–ó–∞–¥–∞—á–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –≤ `trade_kb` —Å embeddings.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
# scripts/sync_vector_kb_cron.py

def sync_vector_kb():
    """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ knowledge_base –≤ trade_kb"""
    vector_kb = VectorKB()
    
    # –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤–æ—Å—Ç–∏ –±–µ–∑ embeddings
    new_news = get_news_without_embeddings(limit=100)
    
    for news in new_news:
        vector_kb.add_event(
            ticker=news['ticker'],
            event_type=news.get('event_type', 'NEWS'),
            content=news['content'],
            ts=news['ts']
        )
```

**Cron –∑–∞–¥–∞—á–∞:**

```bash
# –ö–∞–∂–¥—ã–π —á–∞—Å: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π
0 * * * * cd /home/cnn/lse && python scripts/sync_vector_kb_cron.py
```

**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å

---

### 4.2. –ê–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–æ–≤ (–ø–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞)

**–ó–∞–¥–∞—á–∞:** –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ö–æ–¥—ã —Å–æ–±—ã—Ç–∏–π –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å `outcome_json`.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
# scripts/analyze_news_outcomes_cron.py

def analyze_outcomes():
    """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥—ã —Å–æ–±—ã—Ç–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π"""
    impact_analyzer = NewsImpactAnalyzer()
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–æ–±—ã—Ç–∏—è –±–µ–∑ –∞–Ω–∞–ª–∏–∑–∞ –∏—Å—Ö–æ–¥–æ–≤ (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)
    events_to_analyze = get_events_without_outcome(days_old=7)
    
    for event in events_to_analyze:
        outcome = impact_analyzer.analyze_event_outcome(
            event_id=event['id'],
            ticker=event['ticker'],
            days_after=7
        )
        update_event_outcome(event['id'], outcome)
```

**Cron –∑–∞–¥–∞—á–∞:**

```bash
# –†–∞–∑ –≤ –¥–µ–Ω—å: –∞–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–æ–≤ —Å–æ–±—ã—Ç–∏–π –Ω–µ–¥–µ–ª—å–Ω–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏
0 2 * * * cd /home/cnn/lse && python scripts/analyze_news_outcomes_cron.py
```

**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å

---

### 4.3. –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ó–∞–¥–∞—á–∞:** –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

**–ú–µ—Ç—Ä–∏–∫–∏:**

1. **–ö–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞:**
   - –°—Ä–µ–¥–Ω—è—è similarity –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –Ω–∞ –∑–∞–ø—Ä–æ—Å

2. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:**
   - Success rate (—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ sentiment —Å –¥–≤–∏–∂–µ–Ω–∏–µ–º)
   - –°—Ä–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –ø–æ—Å–ª–µ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π

3. **–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–µ—à–µ–Ω–∏—è:**
   - Win Rate —Å–¥–µ–ª–æ–∫ —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º vs –±–µ–∑
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ—à–µ–Ω–∏–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
# services/news_impact_metrics.py

def track_decision_quality(
    decision_id: int,
    used_historical_context: bool,
    outcome: str  # 'WIN' | 'LOSS' | 'NEUTRAL'
):
    """–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Ä–µ—à–µ–Ω–∏–π —Å/–±–µ–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"""
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ –≤ –ë–î –∏–ª–∏ –ª–æ–≥
```

**–í—Ä–µ–º—è:** 1-2 –¥–Ω—è

---

## üìã –ò—Ç–æ–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (5-7 –¥–Ω–µ–π)

1. ‚úÖ **–°–æ–∑–¥–∞—Ç—å `services/vector_kb.py`**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings (OpenAI –∏–ª–∏ sentence-transformers)
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ `trade_kb`
   - –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π

2. ‚úÖ **–°–æ–∑–¥–∞—Ç—å `services/news_impact_analyzer.py`**
   - –ê–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–æ–≤ —Å–æ–±—ã—Ç–∏–π (–¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã –ø–æ—Å–ª–µ –Ω–æ–≤–æ—Å—Ç–∏)
   - –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

3. ‚úÖ **–†–∞—Å—à–∏—Ä–∏—Ç—å `trade_kb`**
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `outcome_json` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ö–æ–¥–æ–≤
   - –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –§–∞–∑–∞ 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (3-4 –¥–Ω—è)

4. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å `get_historical_context()` –≤ `AnalystAgent`**
   - –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–±—ã—Ç–∏–π
   - –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

5. ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `get_decision_with_llm()`**
   - –ü–µ—Ä–µ–¥–∞—á–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ LLM
   - –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏

6. ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ `StrategyManager`**
   - –£—á–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

### –§–∞–∑–∞ 3: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (2-3 –¥–Ω—è)

7. ‚úÖ **–°–æ–∑–¥–∞—Ç—å `scripts/sync_vector_kb_cron.py`**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π

8. ‚úÖ **–°–æ–∑–¥–∞—Ç—å `scripts/analyze_news_outcomes_cron.py`**
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–æ–≤ —Å–æ–±—ã—Ç–∏–π

9. ‚úÖ **–ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –§–∞–∑–∞ 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (2-3 –¥–Ω—è)

10. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
    - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤

11. ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**
    - –¢–µ—Å—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞
    - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (threshold, limit)

---

## üí∞ –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

### OpenAI Embeddings (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings:** ~$0.02 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤
- **–ù–∞—á–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º:** ~10,000 –Ω–æ–≤–æ—Å—Ç–µ–π √ó 100 —Ç–æ–∫–µ–Ω–æ–≤ = 1M —Ç–æ–∫–µ–Ω–æ–≤ ‚âà **$0.20**
- **–ï–∂–µ–º–µ—Å—è—á–Ω–æ:** ~1,000 –Ω–æ–≤—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π ‚âà **$0.02/–º–µ—Å—è—Ü**

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** `sentence-transformers` –ª–æ–∫–∞–ª—å–Ω–æ ‚Äî **–±–µ—Å–ø–ª–∞—Ç–Ω–æ**, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç CPU/GPU.

### LLM –¥–ª—è sentiment (–µ—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞)

- **Groq (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier):** –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è sentiment
- **Ollama (–ª–æ–∫–∞–ª—å–Ω–æ):** –ë–µ—Å–ø–ª–∞—Ç–Ω–æ

---

## üéØ –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

1. ‚úÖ **–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ `knowledge_base` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ `trade_kb`**
2. ‚úÖ **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (< 1 —Å–µ–∫—É–Ω–¥—ã)**
3. ‚úÖ **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —É–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Ä–µ—à–µ–Ω–∏–π (Win Rate +2-5%)**
4. ‚úÖ **–°—Ç–æ–∏–º–æ—Å—Ç—å OpenAI API < $1/–º–µ—Å—è—Ü –ø—Ä–∏ —Ç–µ–∫—É—â–µ–º –æ–±—ä–µ–º–µ –¥–∞–Ω–Ω—ã—Ö**

---

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –í—ã—Å–æ–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å OpenAI API
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sentence-transformers` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ embeddings
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å embeddings –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –¥–µ—à–µ–≤—É—é –º–æ–¥–µ–ª—å `text-embedding-3-small`

### –†–∏—Å–∫ 2: –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ embeddings
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ (threshold, limit)
- –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–µ –∏—Å–∫–∞—Ç—å —Å–æ–±—ã—Ç–∏—è —Å—Ç–∞—Ä—à–µ 1 –≥–æ–¥–∞)

### –†–∏—Å–∫ 3: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã `ivfflat` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (limit=5-10)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–∫–µ—Ä—É –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞

### –†–∏—Å–∫ 4: –ù–∏–∑–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è —Å –≤—ã—Å–æ–∫–æ–π similarity (>0.8)
- –£—á–∏—Ç—ã–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (—Ä—ã–Ω–æ—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –º–æ–≥–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è)
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –∞–Ω–∞–ª–∏–∑–æ–º, –Ω–µ –ø–æ–ª–∞–≥–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—é

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–í—ã–±—Ä–∞—Ç—å –º–æ–¥–µ–ª—å –¥–ª—è embeddings:**
   - OpenAI `text-embedding-3-small` (–ø–ª–∞—Ç–Ω–æ, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ)
   - `sentence-transformers` –ª–æ–∫–∞–ª—å–Ω–æ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Å—É—Ä—Å—ã)
   - Groq/Ollama (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç embeddings)

2. **–°–æ–∑–¥–∞—Ç—å `services/vector_kb.py`** —Å –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é

3. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞

4. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å `AnalystAgent`** –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∏–π

5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ API

---

**–°—Ç–∞—Ç—É—Å:** üü° –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–æ–≤)  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** OpenAI API –∫–ª—é—á –∏–ª–∏ sentence-transformers, pgvector —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)
