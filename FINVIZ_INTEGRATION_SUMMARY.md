# Сводка: Интеграция с Finviz.com

## ✅ Что реализовано

### 1. Модуль парсинга Finviz

- ✅ Создан `services/finviz_parser.py` с классом `FinvizParser`
- ✅ Функция получения RSI для конкретного тикера
- ✅ Функция получения перепроданных стоков (RSI < 30)
- ✅ Функция получения всех технических индикаторов
- ✅ Защита от блокировки (задержка между запросами)

### 2. Обновление базы данных

- ✅ Добавлено поле `rsi DECIMAL(5,2)` в таблицу `quotes`
- ✅ Миграция для существующих таблиц (автоматическое добавление колонки)
- ✅ Обновлены все INSERT запросы для включения поля `rsi`

### 3. Скрипт обновления RSI

- ✅ Создан `update_finviz_data.py` для обновления RSI из Finviz
- ✅ Поддержка обновления всех тикеров или конкретного списка
- ✅ Функция получения перепроданных стоков с обновлением в БД

### 4. Интеграция в существующий код

- ✅ Обновлен `analyst_agent.py` - запросы теперь включают RSI
- ✅ Обновлен `backtest_engine.py` - бэктестинг использует RSI
- ✅ Обновлен `update_prices.py` - INSERT включает поле RSI (NULL по умолчанию)
- ✅ Обновлен `init_db.py` - seed_data включает поле RSI

### 5. Зависимости

- ✅ Добавлены в `requirements.txt`:
  - `requests>=2.31.0`
  - `beautifulsoup4>=4.12.0`

### 6. Документация

- ✅ Создан `docs/FINVIZ_INTEGRATION.md` с подробным описанием использования

## Использование

### Обновление RSI для всех тикеров

```bash
python update_finviz_data.py
```

### Обновление RSI для конкретных тикеров

```bash
python update_finviz_data.py MSFT,AAPL,TSLA
```

### Получение перепроданных стоков

```bash
python update_finviz_data.py --oversold NYSE 30
```

### В Python коде

```python
from services.finviz_parser import get_rsi_for_tickers

# Получение RSI для нескольких тикеров
rsi_data = get_rsi_for_tickers(["MSFT", "AAPL"])
print(rsi_data)  # {'MSFT': 45.5, 'AAPL': 52.3}
```

## Преимущества

1. **Экономия ресурсов** - не нужно рассчитывать RSI самостоятельно
2. **Проверенные данные** - используем данные с доверенного ресурса Finviz
3. **Актуальность** - данные обновляются с Finviz в реальном времени
4. **Гибкость** - можно получать различные технические индикаторы
5. **Перепроданные стоки** - легко находить возможности для покупки

## Следующие шаги

1. Настроить cron для автоматического обновления RSI (например, ежедневно в 19:00)
2. Использовать RSI в стратегиях для улучшения торговых решений
3. Расширить парсинг других индикаторов с Finviz (MACD, SMA и т.д.)

## Файлы

- `services/finviz_parser.py` - модуль парсинга Finviz
- `update_finviz_data.py` - скрипт обновления RSI
- `docs/FINVIZ_INTEGRATION.md` - подробная документация
- `requirements.txt` - обновлен с новыми зависимостями

## Примечания

- RSI обновляется отдельно от цен (через `update_finviz_data.py`)
- Между запросами к Finviz есть задержка (1-1.5 сек) для избежания блокировки
- Если Finviz недоступен, RSI останется NULL в базе данных

